{% extends "base.html" %}
{% load static %}

{% block title %}Agenda - Calendario{% endblock title %}

{% block extra_css %}
<link href="{% static 'css/calendario.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="hero-section">
    <!-- Encabezado fijo a la izquierda superior -->
    <h2 class="section-title">
        <a href="javascript:history.back()" class="back-arrow" title="Regresar">
            <i class="bi bi-arrow-left"></i>
        </a>
        Calendario
    </h2>

    <!-- Controles del mes -->
    <div class="calendar-header">
        <button class="nav-btn" id="prevMonth" title="Mes anterior">
            <i class="bi bi-chevron-left"></i>
        </button>

        <h3 class="month-title" id="monthTitle">Febrero 2024</h3>

        <button class="nav-btn" id="nextMonth" title="Mes siguiente">
            <i class="bi bi-chevron-right"></i>
        </button>
    </div>

    <!-- Calendario -->
    <div id="calendar"></div>
</div>

<!-- Modal para ver informacion de la tarea Tarea -->
<div class="modal fade" id="modalFinalizar" tabindex="-1" aria-labelledby="modalFinalizarLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalFinalizarLabel">
                    <i class="bi bi-check-circle me-2"></i>Titulo de la tarea
                </h5>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <ul>
                        <li>Materia: Titulo de la materia</li>
                        <li>Vence: Fecha de vencimiento</li>
                        <li>Modalidad: Individual o En equipo</li>
                        <li>Estado: Nuevo</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hecho</button>
                <button type="button" class="btn btn-success">Editar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para ver tareas del día -->
<div class="modal fade" id="modalTareas" tabindex="-1" aria-labelledby="modalTareasLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTareasLabel">
                    <i class="bi bi-calendar-check me-2"></i>
                    <span id="modalFecha">Tareas del día</span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="listaTareas">
                    <!-- Las tareas se cargarán aquí dinámicamente -->
                    <div class="tarea-item">
                        <div class="tarea-nombre">Investigación de lenguajes</div>
                        <div class="tarea-detalle">Programación Web - Vence hoy</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-eye me-1"></i>Ver
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Datos de ejemplo de tareas
        const tareas = [
            {
                title: 'Investigación de lenguajes',
                start: '2025-11-15',
                materia: 'Programación Web',
                descripcion: 'Realizar investigación sobre lenguajes web modernos',
                estado: 'Pendiente'
            },
        ];

        // Inicializar calendario
        const calendarEl = document.getElementById('calendar');
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'es',
            headerToolbar: {
                left: '',
                center: '',
                right: ''
            },
            events: tareas.map(tarea => ({
                title: tarea.title,
                start: tarea.start,
                extendedProps: {
                    materia: tarea.materia,
                    descripcion: tarea.descripcion,
                    estado: tarea.estado
                }
            })),
            eventClick: function (info) {
                const tarea = info.event;
                const fecha = tarea.start.toLocaleDateString('es-ES');

                document.getElementById('modalFecha').textContent = `Tareas para ${fecha}`;
                document.getElementById('listaTareas').innerHTML = `
                <div class="tarea-item">
                    <div class="tarea-nombre">${tarea.title}</div>
                    <div class="tarea-detalle">
                        ${tarea.extendedProps.materia} - ${tarea.extendedProps.estado}
                    </div>
                    <div class="tarea-detalle">${tarea.extendedProps.descripcion}</div>
                </div>
            `;

                const modal = new bootstrap.Modal(document.getElementById('modalTareas'));
                modal.show();
            },
            dateClick: function (info) {
                const fecha = info.dateStr;
                const tareasDelDia = tareas.filter(tarea => tarea.start === fecha);

                document.getElementById('modalFecha').textContent = `Tareas para ${info.date.toLocaleDateString('es-ES')}`;

                if (tareasDelDia.length > 0) {
                    let html = '';
                    tareasDelDia.forEach(tarea => {
                        html += `
                        <div class="tarea-item">
                            <div class="tarea-nombre">${tarea.title}</div>
                            <div class="tarea-detalle">
                                ${tarea.materia} - ${tarea.estado}
                            </div>
                            <div class="tarea-detalle">${tarea.descripcion}</div>
                        </div>
                    `;
                    });
                    document.getElementById('listaTareas').innerHTML = html;
                } else {
                    document.getElementById('listaTareas').innerHTML =
                        '<p class="text-muted text-center">No hay tareas para este día</p>';
                }

                const modal = new bootstrap.Modal(document.getElementById('modalTareas'));
                modal.show();
            }
        });

        calendar.render();

        // Actualizar título del mes
        function updateMonthTitle() {
            const currentDate = calendar.getDate();
            const monthTitle = currentDate.toLocaleDateString('es-ES', {
                month: 'long',
                year: 'numeric'
            });
            document.getElementById('monthTitle').textContent =
                monthTitle.charAt(0).toUpperCase() + monthTitle.slice(1);
        }

        updateMonthTitle();

        // Navegación entre meses
        document.getElementById('prevMonth').addEventListener('click', function () {
            calendar.prev();
            updateMonthTitle();
        });

        document.getElementById('nextMonth').addEventListener('click', function () {
            calendar.next();
            updateMonthTitle();
        });

        // Tu script existente para ocultar header
        let lastScrollY = window.scrollY;
        const sectionTitle = document.querySelector('.section-title');
        let ticking = false;

        function updateHeader() {
            if (window.scrollY > lastScrollY && window.scrollY > 100) {
                sectionTitle.classList.add('hidden');
            } else {
                sectionTitle.classList.remove('hidden');
            }
            lastScrollY = window.scrollY;
            ticking = false;
        }

        function onScroll() {
            if (!ticking) {
                requestAnimationFrame(updateHeader);
                ticking = true;
            }
        }

        window.addEventListener('scroll', onScroll, { passive: true });

        document.addEventListener('mousemove', (e) => {
            if (e.clientY < 100 && sectionTitle.classList.contains('hidden')) {
                sectionTitle.classList.remove('hidden');
            }
        });
    });
</script>

{% endblock %}