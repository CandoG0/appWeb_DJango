{% extends "base.html" %}
{% load static %}

{% block title %}Agenda{% endblock title %}

{% block extra_css %}
<link href="{% static 'css/inicio.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="hero-section {% if tareas_por_vencer.hoy > 0 or tareas_por_vencer.proxima_semana > 0 or tareas_por_vencer.vencidas > 0 %}with-alert{% else %}without-alert{% endif %}">
    <!-- Título de sección en esquina superior izquierda -->
    <h2 class="section-title">Inicio</h2>

    <!-- Notificación de tareas por vencer -->
    {% if tareas_por_vencer.hoy > 0 or tareas_por_vencer.proxima_semana > 0 or tareas_por_vencer.vencidas > 0 %}
    <div class="alert-notification">
        <div class="alert-content">
            <div class="alert-text">
                <strong>Tareas pendientes:</strong>
                {% if tareas_por_vencer.vencidas > 0 %}
                <span class="alert-highlight alert-danger">{{ tareas_por_vencer.vencidas }} vencidas</span>
                {% if tareas_por_vencer.hoy > 0 or tareas_por_vencer.proxima_semana > 0 %} · {% endif %}
                {% endif %}
                {% if tareas_por_vencer.hoy > 0 %}
                <span class="alert-highlight alert-today">{{ tareas_por_vencer.hoy }} para hoy</span>
                {% if tareas_por_vencer.proxima_semana > 0 %} · {% endif %}
                {% endif %}
                {% if tareas_por_vencer.proxima_semana > 0 %}
                <span class="alert-highlight alert-week">{{ tareas_por_vencer.proxima_semana }} esta semana</span>
                {% endif %}
            </div>
            <a href="{% url 'miapp:listar_tareas' %}" class="alert-action">
                Ver detalles
            </a>
        </div>
        <button class="alert-close" onclick="this.parentElement.style.display='none'">
            <i class="bi bi-x"></i>
        </button>
    </div>
    {% endif %}

    <!-- Título principal -->
    <h1 class="welcome-title">
        Hola,
        {% if usuario_actual %}
        {{ usuario_actual.nombre|default:"Usuario" }}
        {% else %}
        Visitante
        {% endif %}
    </h1>

    <h2 class="welcome-subtitle">¿Cuáles son los pendientes de hoy?</h2>

    <!-- Botones -->
    <div class="buttons-container">
        <!-- El url 'miapp:crear_tarea' viene de la carpeta miapp urls.py apartado name-->
        <a href="{% url 'miapp:crear_tarea' %}" class="btn-primary-custom">
            Crear una nueva tarea
            <i class="bi bi-arrow-right-circle"></i>
        </a>
        <a href="{% url 'miapp:listar_tareas' %}" class="btn-secondary-custom">
            Revisar tareas pendientes
            <i class="bi bi-arrow-right-circle"></i>
        </a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const alertNotification = document.querySelector('.alert-notification');
            const closeButton = document.querySelector('.alert-close');
            const heroSection = document.querySelector('.hero-section');

            if (alertNotification && closeButton && heroSection) {
                const sessionKey = 'alertClosed_' + new Date().toDateString();

                if (!sessionStorage.getItem(sessionKey)) {
                    alertNotification.style.display = 'flex';
                    heroSection.classList.add('with-alert');
                    heroSection.classList.remove('without-alert');
                } else {
                    // Si ya estaba cerrada, asegurar que tenga la clase correcta
                    heroSection.classList.add('without-alert');
                    heroSection.classList.remove('with-alert');
                }

                closeButton.addEventListener('click', function () {
                    sessionStorage.setItem(sessionKey, 'true');
                    alertNotification.style.display = 'none';
                    heroSection.classList.remove('with-alert');
                    heroSection.classList.add('without-alert');
                });
            }
        });
    </script>

</div>
{% endblock content %}